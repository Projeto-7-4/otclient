name: Build OTClient

# Desabilitado temporariamente - precisa de estrutura completa do projeto
# Para compilar, use o m√©todo manual no Windows
on:
  workflow_dispatch:  # Apenas manual por enquanto
  # push:
  #   branches: [ develop, main ]

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Check for CMakeLists.txt
        run: |
          if [ ! -f "CMakeLists.txt" ] && [ ! -f "src/CMakeLists.txt" ]; then
            echo "‚ùå CMakeLists.txt n√£o encontrado!"
            echo "üí° Este reposit√≥rio n√£o tem a estrutura completa para compilar"
            echo "   Por favor, compile manualmente no Windows"
            exit 1
          fi

      - name: Install dependencies
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y -qq \
            build-essential cmake ninja-build \
            libgl1-mesa-dev libglu1-mesa-dev \
            libx11-dev libxrandr-dev libxi-dev \
            libxcursor-dev libxinerama-dev \
            libasound2-dev libpulse-dev \
            libudev-dev libssl-dev zlib1g-dev liblzma-dev

      - name: Build (se CMakeLists.txt existir)
        run: |
          if [ -f "CMakeLists.txt" ]; then
            mkdir -p build && cd build
            cmake -DCMAKE_BUILD_TYPE=Release -GNinja ..
            ninja -j$(nproc)
          elif [ -f "src/CMakeLists.txt" ]; then
            mkdir -p build && cd build
            cmake -DCMAKE_BUILD_TYPE=Release -GNinja ../src
            ninja -j$(nproc)
          fi

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: otclient
          path: build/otclient*
          if-no-files-found: ignore
